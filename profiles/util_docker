#!/bin/bash
#------------------------------------------------
# Docker helpers
#------------------------------------------------


# Handle command completions
test -e "/Applications/Docker.app/Contents/Resources/etc/docker.bash-completion" && source "/Applications/Docker.app/Contents/Resources/etc/docker.bash-completion"
test -e "/Applications/Docker.app/Contents/Resources/etc/docker-machine.bash-completion" && source "/Applications/Docker.app/Contents/Resources/etc/docker-machine.bash-completion"
test -e "/Applications/Docker.app/Contents/Resources/etc/docker-compose.bash-completion" && source "/Applications/Docker.app/Contents/Resources/etc/docker-compose.bash-completion"

function dock-help() {
	echo "dock-image-clean :  Clean dangling images"
  echo "dock-image-rm :  Remove an image"
	echo "dock-container-rm :  Delete all containers"
  echo "dock-container-killall : Kill all containers"
  echo "dock-container-find : Find container id based on name"
  echo "dock-container-inspect : Inspect container based on name"

}


###########
##
## Docker images
##
###########

# show docker images
function di-ls(){
  docker image ls
}

# Remove dangling images
function di-clean() {
  	docker rmi $* $(docker images -q -a -f dangling=true)
}


function di-rm() { 
  if [ $# -lt 1 ]
    then
      echo "Provide image id"
      return 1
    fi
  docker rmi $1; 
}



# remove latest created images
function di-rm-la(){
  dc-rm $(docker images -q | awk 'NR == 1 {print $0}')
}

# Remove all Docker images
alias di-rm-all='docker rmi $(docker images -q)'
alias di='docker images'


###########
##
## Docker containers
##
###########

function dc-rm() { 
	docker rm $@
}

function dc-rm-all(){
  # Remove all Docker container
  docker rm $(docker ps -a -q)
}

#Inspect a running Docker container
function dc-find() {
  docker ps | grep "$1 " | cut -d ' ' -f1
}

function dc-exec() {
  docker exec -it `find_docker_container $1` /bin/bash
}

# show cotainer logs. You would pass the container id
function dc-logs(){
  docker logs $1
}

# watching cotainer logs. You would pass the container id
function dc-tail(){
  docker logs -f $1
}

function dc-run(){
  echo
}

function dc-stop(){
  docker stop $@
}

function dc-stop-all(){
  docker stop $(docker ps -a -q)
}

function dc-rm-all() { 
  echo "Deleting all containers"
  docker rm $(docker ps -qf "status=exited") $(docker ps -qf "status=created")
}


alias dc-ps='docker ps'
alias dc-psa='docker ps -a'
alias dc-pss='docker ps -f "status=exited"'
alias dc-up='docker-compose up -d'
alias dc-down='docker-compose down -v'
# Kill all running Docker container
alias dc-kill-all='docker kill $(docker ps -q)'

###########
##
## Docker volumes
##
###########

# show all docker volulmes
alias dv-ls='docker volume ls'

# remove some volumes. You would pass the volume names.
function dv-rm(){
  docker volume rm $@
}


# Store all container commands in host bash history
alias dock-bash='docker run -e HIST_FILE=/root/.bash_history -v=$HOME/.bash_history:/root/.bash_history'

